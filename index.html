<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ابرک | ABRAK</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
        }
        
        header {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            opacity: 0.1;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            z-index: 1;
            position: relative;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .site-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d35400;
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        .btn-logout {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-logout:hover {
            background-color: #7f8c8d;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        .page {
            display: none;
            width: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .active {
            display: block;
        }
        
        .auth-container {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .auth-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        input[type="text"], input[type="password"], input[type="number"], input[type="tel"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, input[type="tel"]:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-input-label:hover {
            background-color: #e9ecef;
            border-color: #3498db;
        }
        
        .products-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }
        
        .product-card {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .product-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            display: block;
            cursor: pointer;
        }
        
        .product-details {
            padding: 20px;
        }
        
        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .product-price {
            font-size: 22px;
            font-weight: 700;
            color: #e74c3c;
        }
        
        .product-actions {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 18px;
            grid-column: 1 / -1;
        }
        
        .admin-panel {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }
        
        .admin-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .user-info {
            background-color: white;
            border-radius: 15px;
            padding: 15px 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .welcome-message {
            font-size: 18px;
            color: #2c3e50;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            background-color: white;
            border-radius: 10px;
            padding: 0 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .admin-tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }
        
        .admin-content {
            display: none;
        }
        
        .admin-content.active {
            display: block;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .users-table th, .users-table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        .users-table th {
            background-color: #f8f9fa;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .users-table tr:last-child td {
            border-bottom: none;
        }
        
        .users-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 700;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .current-image {
            max-width: 100%;
            max-height: 200px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        /* استایل‌های جدید برای بهبودها */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            max-width: 300px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease-out;
        }
        
        .message.error {
            background: #e74c3c;
        }
        
        .message.success {
            background: #2ecc71;
        }
        
        .message.info {
            background: #3498db;
        }
        
        .message.warning {
            background: #f39c12;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .user-guide {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-right: 5px solid #3498db;
        }
        
        .user-guide h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .user-guide ul {
            list-style-type: none;
            padding-right: 20px;
        }
        
        .user-guide li {
            margin-bottom: 10px;
            position: relative;
            padding-right: 25px;
        }
        
        .user-guide li:before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            position: absolute;
            right: 0;
        }
        
        .validation-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: block;
        }
        
        .input-error {
            border-color: #e74c3c !important;
        }
        
        .about-section {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            width: 300px;
            float: left;
            margin-left: 20px;
        }
        
        .about-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .about-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }
        
        .about-title {
            font-size: 18px;
            color: #2c3e50;
            font-weight: 700;
        }
        
        .about-content {
            line-height: 1.6;
            color: #34495e;
            font-size: 14px;
        }
        
        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 50px;
            height: 50px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
        }
        
        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .scroll-to-top:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
        }
        
        .user-profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .code-editor {
            font-family: 'Courier New', monospace;
            min-height: 200px;
        }
        
        /* استایل‌های جدید برای قابلیت‌های درخواستی */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1100;
            justify-content: center;
            align-items: center;
        }
        
        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
        }
        
        .close-image-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .bulk-product-input {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .product-input-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: start;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            position: relative;
            margin-bottom: 10px;
        }
        
        .product-input-row input, .product-input-row textarea {
            width: 100%;
        }
        
        .image-upload-container {
            position: relative;
            width: 100%;
        }
        
        .image-preview-container {
            position: relative;
            display: none;
            margin-top: 10px;
        }
        
        .preview-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #3498db;
        }
        
        .remove-image-btn {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 24px;
            height: 24px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .remove-image-btn:hover {
            background: #c0392b;
        }
        
        .remove-product-row {
            white-space: nowrap;
        }
        
        .cart-btn {
            position: absolute;
            bottom: 10px;
            left: 10px;
        }
        
        .cart-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .cart-total {
            text-align: left;
            font-size: 20px;
            font-weight: 700;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .payment-info {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tracking-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .admin-order-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            background-color: white;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .admin-order-item:last-child {
            border-bottom: none;
        }
        
        .order-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-shipped {
            background-color: #d4edda;
            color: #155724;
        }
        
        .remove-item-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .remove-item-btn:hover {
            background-color: #c0392b;
        }
        
        .admin-message-input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .admin-order-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .user-order-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .status-waiting {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .admin-cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .order-details {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .order-details h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .order-details-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .order-details-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #e74c3c;
        }
        
        .order-history {
            margin-top: 30px;
        }
        
        .order-history-item {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .order-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .order-history-date {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .order-products-images {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .order-product-thumb {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .user-profile-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .profile-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .profile-form .form-group {
            margin-bottom: 15px;
        }
        
        .profile-full-width {
            grid-column: 1 / -1;
        }
        
        .user-details-modal {
            max-width: 600px;
        }
        
        .user-details-content {
            line-height: 1.8;
        }
        
        .user-detail-item {
            margin-bottom: 10px;
            display: flex;
        }
        
        .user-detail-label {
            font-weight: bold;
            min-width: 120px;
            color: #2c3e50;
        }
        
        .user-detail-value {
            flex: 1;
            color: #34495e;
        }
        
        /* استایل‌های جدید برای مشخصات محصول و نظرات */
        .product-specs {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .specs-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .specs-content {
            color: #34495e;
            line-height: 1.5;
        }
        
        .comments-section {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .comments-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .comment-form {
            margin-bottom: 20px;
        }
        
        .comment-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            resize: vertical;
            min-height: 80px;
        }
        
        .comment-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
            position: relative;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .comment-author {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .comment-date {
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .comment-content {
            color: #34495e;
            line-height: 1.5;
        }
        
        .no-comments {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
        }
        
        .specs-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
            resize: vertical;
            min-height: 60px;
        }
        
        .profile-warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #ffeaa7;
        }
        
        .delete-comment-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .delete-comment-btn:hover {
            background: #c0392b;
        }
        
        .admin-comments-section {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .admin-comment-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
            position: relative;
        }
        
        .admin-comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .admin-comment-product {
            font-weight: bold;
            color: #3498db;
        }
        
        .admin-delete-comment-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .admin-delete-comment-btn:hover {
            background: #c0392b;
        }
        
        /* استایل‌های جدید برای جستجو و فیلتر */
        .search-filter-container {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }
        
        .search-box {
            margin-bottom: 15px;
        }
        
        .filter-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .filter-options select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
        }
        
        .update-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .update-notification.show {
            display: flex;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .user-activity-log {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .activity-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            color: #7f8c8d;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .products-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .user-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .users-table {
                display: block;
                overflow-x: auto;
            }
            
            .message {
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .about-header {
                flex-direction: column;
                text-align: center;
            }
            
            .scroll-to-top {
                left: 20px;
                bottom: 20px;
            }
            
            .about-section {
                width: 100%;
                float: none;
                margin-left: 0;
            }
            
            .product-input-row {
                grid-template-columns: 1fr;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header id="site-header">
            <img id="header-background" class="header-background" src="" alt="پس‌زمینه هدر">
            <div class="header-content">
                <div class="logo-container">
                    <img id="site-logo" class="site-logo" src="" alt="لوگو سایت">
                    <div class="logo" id="site-title">ابرک | ABRAK</div>
                </div>
                <div class="auth-buttons">
                    <button id="logout-btn" class="btn btn-logout" style="display: none;">خروج</button>
                    <button id="cart-btn" class="btn btn-info" style="display: none;">سبد خرید</button>
                    <button id="profile-btn" class="btn btn-info" style="display: none;">پروفایل من</button>
                </div>
            </div>
        </header>
        
        <!-- صفحه ورود/ثبت‌نام -->
        <div id="auth-page" class="page active">
            <div class="user-guide">
                <h3>راهنمای استفاده از سایت</h3>
                <ul>
                    <li>برای خرید، ابتدا ثبت‌نام کنید یا وارد شوید</li>
                    <li>نام کاربری باید حداقل ۳ کاراکتر باشد</li>
                    <li>رمز عبور باید حداقل ۶ کاراکتر باشد</li>
                </ul>
            </div>
            
            <div class="auth-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">ورود</div>
                    <div class="auth-tab" data-tab="register">ثبت‌نام</div>
                </div>
                
                <!-- فرم ورود -->
                <div id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-username">نام کاربری:</label>
                        <input type="text" id="login-username" placeholder="نام کاربری خود را وارد کنید">
                        <span class="validation-error" id="login-username-error"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">رمز عبور:</label>
                        <input type="password" id="login-password" placeholder="رمز عبور خود را وارد کنید">
                        <span class="validation-error" id="login-password-error"></span>
                    </div>
                    
                    <button id="login-btn" class="btn btn-primary" style="width: 100%;">ورود به سایت</button>
                </div>
                
                <!-- فرم ثبت‌نام -->
                <div id="register-form" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label for="register-username">نام کاربری:</label>
                        <input type="text" id="register-username" placeholder="نام کاربری دلخواه خود را وارد کنید">
                        <span class="validation-error" id="register-username-error"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password">رمز عبور:</label>
                        <input type="password" id="register-password" placeholder="رمز عبور دلخواه خود را وارد کنید">
                        <span class="validation-error" id="register-password-error"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">تکرار رمز عبور:</label>
                        <input type="password" id="confirm-password" placeholder="رمز عبور خود را مجدداً وارد کنید">
                        <span class="validation-error" id="confirm-password-error"></span>
                    </div>
                    
                    <button id="register-btn" class="btn btn-primary" style="width: 100%;">ثبت‌نام</button>
                </div>
            </div>
        </div>
        
        <!-- صفحه محصولات کاربر -->
        <div id="user-page" class="page">
            <div class="user-info">
                <div class="welcome-message">خوش آمدید، <span id="username-display"></span></div>
            </div>
            
            <div class="about-section" id="user-about-section">
                <!-- محتوای درباره ما اینجا نمایش داده می‌شود -->
            </div>
            
            <!-- بخش جستجو و فیلتر -->
            <div class="search-filter-container">
                <div class="search-box">
                    <input type="text" id="product-search" placeholder="جستجوی محصولات...">
                </div>
                <div class="filter-options">
                    <select id="price-filter">
                        <option value="">همه قیمت‌ها</option>
                        <option value="0-50000">تا 50,000 تومان</option>
                        <option value="50000-200000">50,000 تا 200,000 تومان</option>
                        <option value="200000-500000">200,000 تا 500,000 تومان</option>
                        <option value="500000+">بالای 500,000 تومان</option>
                    </select>
                    <button id="clear-filters" class="btn btn-secondary btn-small">پاک کردن فیلترها</button>
                </div>
            </div>
            
            <div class="products-container" id="user-products-list">
                <div class="empty-state">هنوز محصولی برای نمایش وجود ندارد</div>
            </div>
        </div>
        
        <!-- صفحه پروفایل کاربر -->
        <div id="profile-page" class="page">
            <div class="user-info">
                <div class="welcome-message">پروفایل کاربری</div>
                <div>
                    <button id="back-to-products-from-profile" class="btn btn-info btn-small">بازگشت به محصولات</button>
                </div>
            </div>
            
            <div class="user-profile-section">
                <h3>مشخصات شخصی</h3>
                <form id="profile-form" class="profile-form">
                    <div class="form-group">
                        <label for="first-name">نام:</label>
                        <input type="text" id="first-name" placeholder="نام خود را وارد کنید">
                    </div>
                    
                    <div class="form-group">
                        <label for="last-name">نام خانوادگی:</label>
                        <input type="text" id="last-name" placeholder="نام خانوادگی خود را وارد کنید">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">شماره تماس:</label>
                        <input type="tel" id="phone" placeholder="شماره تماس خود را وارد کنید">
                    </div>
                    
                    <div class="form-group">
                        <label for="postal-code">کد پستی:</label>
                        <input type="text" id="postal-code" placeholder="کد پستی خود را وارد کنید">
                    </div>
                    
                    <div class="form-group profile-full-width">
                        <label for="address">آدرس:</label>
                        <textarea id="address" placeholder="آدرس کامل خود را وارد کنید"></textarea>
                    </div>
                    
                    <div class="form-group profile-full-width">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">ذخیره مشخصات</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- صفحه سبد خرید کاربر -->
        <div id="cart-page" class="page">
            <div class="user-info">
                <div class="welcome-message">سبد خرید شما</div>
                <div>
                    <button id="back-to-products" class="btn btn-info btn-small">بازگشت به محصولات</button>
                </div>
            </div>
            
            <div class="cart-section" id="cart-items-container">
                <div class="empty-state">سبد خرید شما خالی است</div>
            </div>
            
            <div class="payment-info">
                <h3>راهنمای پرداخت</h3>
                <p>لطفاً مبلغ کل خرید خود را به شماره کارت زیر واریز نمایید:</p>
                <p style="font-weight: bold; font-size: 18px; margin: 10px 0;">6037-9974-5358-7736</p>
                <p>به نام: مجتبی امیری‌گانه</p>
                <p>پس از واریز، شماره پیگیری یا ارجاع خود را در قسمت زیر وارد کنید:</p>
                
                <div class="tracking-section">
                    <!-- هشدار در صورت تکمیل نکردن پروفایل -->
                    <div id="profile-warning" class="profile-warning" style="display: none;">
                        برای ثبت سفارش لطفاً ابتدا مشخصات شخصی خود را در بخش پروفایل تکمیل کنید.
                    </div>
                    
                    <div class="form-group">
                        <label for="tracking-number">شماره پیگیری/ارجاع:</label>
                        <input type="text" id="tracking-number" placeholder="شماره پیگیری یا ارجاع خود را وارد کنید">
                    </div>
                    <button id="submit-tracking" class="btn btn-primary">ثبت شماره پیگیری</button>
                </div>
                
                <!-- بخش وضعیت سفارش -->
                <div id="order-status-section">
                    <div class="order-history">
                        <h3>تاریخچه سفارشات شما</h3>
                        <div id="order-history-list">
                            <!-- سفارشات گذشته اینجا نمایش داده می‌شوند -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- صفحه مدیر -->
        <div id="admin-page" class="page">
            <div class="user-info">
                <div class="welcome-message">پنل مدیریت</div>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="products-management">مدیریت محصولات</div>
                <div class="admin-tab" data-tab="users-management">مدیریت کاربران</div>
                <div class="admin-tab" data-tab="site-settings">تنظیمات سایت</div>
                <div class="admin-tab" data-tab="custom-code">کدهای سفارشی</div>
                <div class="admin-tab" data-tab="about-management">مدیریت درباره ما</div>
                <div class="admin-tab" data-tab="orders-management">مدیریت سفارشات</div>
                <div class="admin-tab" data-tab="comments-management">مدیریت نظرات</div>
                <div class="admin-tab" data-tab="activity-management">فعالیت کاربران</div>
            </div>
            
            <!-- بخش مدیریت محصولات -->
            <div id="products-management" class="admin-content active">
                <div class="admin-panel">
                    <div class="admin-title">افزودن محصول جدید</div>
                    
                    <div class="bulk-product-input" id="bulk-product-inputs">
                        <!-- ردیف‌های ورود محصولات به صورت دینامیک اضافه می‌شوند -->
                    </div>
                    
                    <button id="add-product-row" class="btn btn-info" style="margin-bottom: 20px;">+ افزودن ردیف محصول</button>
                    <button id="add-products" class="btn btn-primary" style="width: 100%;">افزودن محصولات</button>
                </div>
                
                <div class="admin-panel">
                    <div class="admin-title">محصولات موجود</div>
                    <div class="products-container" id="admin-products-list">
                        <div class="empty-state">هنوز محصولی اضافه نکرده‌اید</div>
                    </div>
                </div>
            </div>
            
            <!-- بخش مدیریت کاربران -->
            <div id="users-management" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">مدیریت کاربران</div>
                    
                    <div class="form-group">
                        <label for="new-username">نام کاربری جدید:</label>
                        <input type="text" id="new-username" placeholder="نام کاربری جدید را وارد کنید">
                        <span class="validation-error" id="new-username-error"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-password">رمز عبور جدید:</label>
                        <input type="password" id="new-password" placeholder="رمز عبور جدید را وارد کنید">
                        <span class="validation-error" id="new-password-error"></span>
                    </div>
                    
                    <button id="add-user" class="btn btn-primary" style="width: 100%;">افزودن کاربر</button>
                </div>
                
                <div class="admin-panel">
                    <div class="admin-title">لیست کاربران</div>
                    
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>نام کاربری</th>
                                <th>تاریخ ثبت‌نام</th>
                                <th>آخرین فعالیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="users-list">
                            <!-- کاربران اینجا نمایش داده می‌شوند -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- بخش تنظیمات سایت -->
            <div id="site-settings" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">تنظیمات سایت</div>
                    
                    <div class="form-group">
                        <label for="site-title-input">عنوان سایت:</label>
                        <input type="text" id="site-title-input" placeholder="عنوان سایت را وارد کنید">
                    </div>
                    
                    <div class="form-group">
                        <label for="site-logo-input">لوگو سایت:</label>
                        <div class="file-input-container">
                            <input type="file" id="site-logo-input" class="file-input" accept="image/*">
                            <label for="site-logo-input" class="file-input-label">انتخاب لوگو سایت</label>
                        </div>
                        <div id="current-site-logo" style="margin-top: 10px;"></div>
                    </div>
                    
                    <button id="save-site-settings" class="btn btn-primary" style="width: 100%;">ذخیره تنظیمات</button>
                </div>
            </div>
            
            <!-- بخش کدهای سفارشی -->
            <div id="custom-code" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">کدهای سفارشی</div>
                    
                    <div class="form-group">
                        <label for="custom-html">کد HTML سفارشی:</label>
                        <textarea id="custom-html" class="code-editor" placeholder="کد HTML خود را اینجا وارد کنید..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="custom-css">کد CSS سفارشی:</label>
                        <textarea id="custom-css" class="code-editor" placeholder="کد CSS خود را اینجا وارد کنید..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="custom-js">کد JavaScript سفارشی:</label>
                        <textarea id="custom-js" class="code-editor" placeholder="کد JavaScript خود را اینجا وارد کنید..."></textarea>
                    </div>
                    
                    <button id="save-custom-code" class="btn btn-primary" style="width: 100%;">ذخیره کدها</button>
                </div>
            </div>
            
            <!-- بخش مدیریت درباره ما -->
            <div id="about-management" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">مدیریت درباره ما</div>
                    
                    <div class="form-group">
                        <label for="about-logo-input">لوگوی درباره ما:</label>
                        <div class="file-input-container">
                            <input type="file" id="about-logo-input" class="file-input" accept="image/*">
                            <label for="about-logo-input" class="file-input-label">انتخاب لوگو درباره ما</label>
                        </div>
                        <div id="current-about-logo" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="about-title-input">عنوان درباره ما:</label>
                        <input type="text" id="about-title-input" placeholder="عنوان درباره ما را وارد کنید">
                    </div>
                    
                    <div class="form-group">
                        <label for="about-content-input">محتوا درباره ما:</label>
                        <textarea id="about-content-input" placeholder="محتوا درباره ما را اینجا وارد کنید..."></textarea>
                    </div>
                    
                    <button id="save-about-content" class="btn btn-primary" style="width: 100%;">ذخیره درباره ما</button>
                </div>
            </div>
            
            <!-- بخش مدیریت سفارشات -->
            <div id="orders-management" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">مدیریت سفارشات کاربران</div>
                    
                    <div id="admin-orders-list">
                        <!-- سفارشات کاربران اینجا نمایش داده می‌شوند -->
                    </div>
                </div>
            </div>

            <!-- بخش مدیریت نظرات -->
            <div id="comments-management" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">مدیریت نظرات کاربران</div>
                    
                    <div id="admin-comments-list">
                        <!-- نظرات کاربران اینجا نمایش داده می‌شوند -->
                    </div>
                </div>
            </div>
            
            <!-- بخش مدیریت فعالیت کاربران -->
            <div id="activity-management" class="admin-content">
                <div class="admin-panel">
                    <div class="admin-title">فعالیت کاربران</div>
                    
                    <div id="user-activity-list">
                        <!-- فعالیت کاربران اینجا نمایش داده می‌شوند -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مودال‌های مختلف -->
    <div id="edit-product-modal" class="modal">
        <!-- محتوای مودال ویرایش محصول -->
    </div>

    <div id="delete-product-modal" class="modal">
        <!-- محتوای مودال حذف محصول -->
    </div>

    <div id="delete-user-modal" class="modal">
        <!-- محتوای مودال حذف کاربر -->
    </div>

    <div id="user-profile-modal" class="modal">
        <!-- محتوای مودال پروفایل کاربر -->
    </div>

    <div id="edit-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ویرایش کاربر</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="edit-username">نام کاربری:</label>
                <input type="text" id="edit-username">
            </div>
            <div class="form-group">
                <label for="edit-password">رمز عبور جدید:</label>
                <input type="password" id="edit-password" placeholder="در صورت عدم تغییر خالی بگذارید">
            </div>
            <div class="modal-actions">
                <button id="save-user-edit" class="btn btn-primary">ذخیره تغییرات</button>
                <button class="close-modal btn btn-secondary">انصراف</button>
            </div>
        </div>
    </div>

    <div id="user-details-modal" class="modal">
        <div class="modal-content user-details-modal">
            <div class="modal-header">
                <div class="modal-title">مشخصات کامل کاربر</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="user-details-content" class="user-details-content">
                <!-- محتوای مشخصات کاربر اینجا نمایش داده می‌شود -->
            </div>
            <div class="modal-actions">
                <button class="close-modal btn btn-secondary">بستن</button>
            </div>
        </div>
    </div>

    <div id="image-modal" class="image-modal">
        <span class="close-image-modal">&times;</span>
        <img class="image-modal-content" id="expanded-image">
    </div>

    <!-- مودال نمایش محصول با جزئیات و نظرات -->
    <div id="product-details-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title" id="product-details-title">جزئیات محصول</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="product-details-content">
                <!-- محتوای جزئیات محصول اینجا نمایش داده می‌شود -->
            </div>
        </div>
    </div>

    <!-- دکمه بازگشت به بالا -->
    <div class="scroll-to-top" id="scroll-to-top">
        ↑
    </div>

    <!-- اعلان بروزرسانی -->
    <div class="update-notification" id="update-notification">
        <span>بروزرسانی جدید موجود است!</span>
        <button id="refresh-page" class="btn btn-success btn-small">بارگذاری مجدد</button>
    </div>

    <!-- صفحه بارگذاری -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // سیستم مدیریت وضعیت
        const AppState = {
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
            users: JSON.parse(localStorage.getItem('users')) || [],
            products: JSON.parse(localStorage.getItem('products')) || [],
            carts: JSON.parse(localStorage.getItem('carts')) || {},
            orders: JSON.parse(localStorage.getItem('orders')) || {},
            userProfiles: JSON.parse(localStorage.getItem('userProfiles')) || {},
            siteSettings: JSON.parse(localStorage.getItem('siteSettings')) || {
                title: 'ابرک | ABRAK',
                siteLogo: ''
            },
            customCode: JSON.parse(localStorage.getItem('customCode')) || {
                html: '',
                css: '',
                js: ''
            },
            aboutContent: JSON.parse(localStorage.getItem('aboutContent')) || {
                logo: '',
                title: 'درباره ما',
                content: 'محتوای درباره ما اینجا نمایش داده خواهد شد.'
            },
            
            // اضافه کردن مشخصات محصولات و نظرات
            productSpecs: JSON.parse(localStorage.getItem('productSpecs')) || {},
            productComments: JSON.parse(localStorage.getItem('productComments')) || {},
            userComments: JSON.parse(localStorage.getItem('userComments')) || {},
            
            // سیستم جدید: لاگ فعالیت کاربران
            userActivity: JSON.parse(localStorage.getItem('userActivity')) || {},
            
            // سیستم جدید: همگام‌سازی با GitHub
            lastUpdate: localStorage.getItem('lastUpdate') || Date.now(),
            updateCheckInterval: 5 * 60 * 1000, // 5 دقیقه
            
            // کلمات ممنوعه برای فیلتر نظرات
            bannedWords: ['فحش', 'توهین', 'کلمه ممنوعه 1', 'کلمه ممنوعه 2'], // می‌توانید لیست را گسترش دهید
            
            // توابع ذخیره‌سازی
            saveUsers() {
                localStorage.setItem('users', JSON.stringify(this.users));
            },
            
            saveProducts() {
                localStorage.setItem('products', JSON.stringify(this.products));
            },
            
            saveCarts() {
                localStorage.setItem('carts', JSON.stringify(this.carts));
            },
            
            saveOrders() {
                localStorage.setItem('orders', JSON.stringify(this.orders));
            },
            
            saveUserProfiles() {
                localStorage.setItem('userProfiles', JSON.stringify(this.userProfiles));
            },
            
            saveSiteSettings() {
                localStorage.setItem('siteSettings', JSON.stringify(this.siteSettings));
            },
            
            saveCustomCode() {
                localStorage.setItem('customCode', JSON.stringify(this.customCode));
            },
            
            saveAboutContent() {
                localStorage.setItem('aboutContent', JSON.stringify(this.aboutContent));
            },
            
            // توابع ذخیره‌سازی جدید
            saveProductSpecs() {
                localStorage.setItem('productSpecs', JSON.stringify(this.productSpecs));
            },
            
            saveProductComments() {
                localStorage.setItem('productComments', JSON.stringify(this.productComments));
            },
            
            saveUserComments() {
                localStorage.setItem('userComments', JSON.stringify(this.userComments));
            },
            
            // توابع جدید برای مدیریت فعالیت کاربران
            saveUserActivity() {
                localStorage.setItem('userActivity', JSON.stringify(this.userActivity));
            },
            
            // تابع جدید برای ثبت فعالیت کاربر
            logUserActivity(username, action, details = {}) {
                if (!this.userActivity[username]) {
                    this.userActivity[username] = [];
                }
                
                const activity = {
                    timestamp: new Date().toLocaleString('fa-IR'),
                    action: action,
                    details: details
                };
                
                this.userActivity[username].push(activity);
                
                // فقط 100 فعالیت آخر را نگه دار
                if (this.userActivity[username].length > 100) {
                    this.userActivity[username] = this.userActivity[username].slice(-100);
                }
                
                this.saveUserActivity();
            },
            
            // تابع جدید برای دریافت فعالیت کاربر
            getUserActivity(username) {
                return this.userActivity[username] || [];
            },
            
            // تابع جدید برای دریافت تمام فعالیت‌ها
            getAllUserActivities() {
                const allActivities = [];
                Object.keys(this.userActivity).forEach(username => {
                    this.userActivity[username].forEach(activity => {
                        allActivities.push({
                            username: username,
                            ...activity
                        });
                    });
                });
                
                // مرتب‌سازی بر اساس زمان (جدیدترین اول)
                return allActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            },
            
            // مدیریت کاربر
            loginUser(username, password) {
                // مدیر نیز مانند سایر کاربران با نام کاربری و رمز عبور وارد می‌شود
                if (username === 'admin' && password === '2190079101') {
                    this.currentUser = { username: 'admin', isAdmin: true };
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    
                    // ثبت فعالیت
                    this.logUserActivity('admin', 'ورود به سیستم');
                    return true;
                }
                
                const user = this.users.find(u => u.username === username && u.password === this.simpleHash(password));
                if (user) {
                    this.currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    
                    // ثبت فعالیت
                    this.logUserActivity(username, 'ورود به سیستم');
                    return true;
                }
                return false;
            },
            
            registerUser(username, password) {
                if (username.length < 3) {
                    return { success: false, message: 'نام کاربری باید حداقل ۳ کاراکتر باشد' };
                }
                
                if (password.length < 6) {
                    return { success: false, message: 'رمز عبور باید حداقل ۶ کاراکتر باشد' };
                }
                
                if (this.users.find(u => u.username === username)) {
                    return { success: false, message: 'این نام کاربری قبلاً استفاده شده است' };
                }
                
                this.users.push({ 
                    username, 
                    password: this.simpleHash(password),
                    registerDate: new Date().toLocaleString('fa-IR'),
                    lastActivity: new Date().toLocaleString('fa-IR')
                });
                this.saveUsers();
                
                // ثبت فعالیت
                this.logUserActivity(username, 'ثبت‌نام در سیستم');
                
                return { success: true, message: 'ثبت‌نام با موفقیت انجام شد' };
            },
            
            updateUser(oldUsername, newUsername, newPassword = null) {
                const user = this.users.find(u => u.username === oldUsername);
                if (!user) {
                    return { success: false, message: 'کاربر یافت نشد' };
                }
                
                if (newUsername !== oldUsername && this.users.find(u => u.username === newUsername)) {
                    return { success: false, message: 'این نام کاربری قبلاً استفاده شده است' };
                }
                
                user.username = newUsername;
                if (newPassword) {
                    user.password = this.simpleHash(newPassword);
                }
                
                this.saveUsers();
                
                // ثبت فعالیت
                this.logUserActivity(oldUsername, 'به‌روزرسانی اطلاعات کاربر');
                
                return { success: true, message: 'اطلاعات کاربر با موفقیت به‌روزرسانی شد' };
            },
            
            updateUserProfile(username, profileData) {
                this.userProfiles[username] = {
                    ...this.userProfiles[username],
                    ...profileData,
                    lastUpdate: new Date().toLocaleString('fa-IR')
                };
                this.saveUserProfiles();
                
                // ثبت فعالیت
                this.logUserActivity(username, 'به‌روزرسانی پروفایل');
                
                return true;
            },
            
            getUserProfile(username) {
                return this.userProfiles[username] || {};
            },
            
            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            },
            
            // مدیریت محصولات
            addProduct(name, price, image) {
                const product = {
                    id: Date.now(),
                    name,
                    price: parseInt(price),
                    image,
                    date: new Date().toLocaleString('fa-IR')
                };
                this.products.push(product);
                this.saveProducts();
                
                // ثبت فعالیت
                if (this.currentUser) {
                    this.logUserActivity(this.currentUser.username, 'افزودن محصول', { productName: name });
                }
                
                return product;
            },
            
            addMultipleProducts(productsData) {
                const addedProducts = [];
                productsData.forEach(data => {
                    if (data.name && data.price) {
                        const product = this.addProduct(data.name, data.price, data.image || '');
                        addedProducts.push(product);
                    }
                });
                return addedProducts;
            },
            
            updateProduct(id, name, price, image) {
                const product = this.products.find(p => p.id === id);
                if (product) {
                    product.name = name;
                    product.price = parseInt(price);
                    if (image) product.image = image;
                    this.saveProducts();
                    
                    // ثبت فعالیت
                    if (this.currentUser) {
                        this.logUserActivity(this.currentUser.username, 'ویرایش محصول', { productName: name });
                    }
                    
                    return true;
                }
                return false;
            },
            
            deleteProduct(id) {
                const product = this.products.find(p => p.id === id);
                this.products = this.products.filter(p => p.id !== id);
                this.saveProducts();
                
                // ثبت فعالیت
                if (this.currentUser && product) {
                    this.logUserActivity(this.currentUser.username, 'حذف محصول', { productName: product.name });
                }
                
                return true;
            },
            
            // مدیریت سبد خرید
            addToCart(username, productId) {
                if (!this.carts[username]) {
                    this.carts[username] = [];
                }
                
                const product = this.products.find(p => p.id === productId);
                if (product) {
                    const existingItem = this.carts[username].find(item => item.id === productId);
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        this.carts[username].push({
                            ...product,
                            quantity: 1
                        });
                    }
                    this.saveCarts();
                    
                    // ثبت فعالیت
                    this.logUserActivity(username, 'افزودن به سبد خرید', { productName: product.name });
                    
                    return true;
                }
                return false;
            },
            
            removeFromCart(username, productId) {
                if (this.carts[username]) {
                    const product = this.products.find(p => p.id === productId);
                    this.carts[username] = this.carts[username].filter(item => item.id !== productId);
                    this.saveCarts();
                    
                    // ثبت فعالیت
                    if (product) {
                        this.logUserActivity(username, 'حذف از سبد خرید', { productName: product.name });
                    }
                    
                    return true;
                }
                return false;
            },
            
            getCartTotal(username) {
                if (!this.carts[username]) return 0;
                return this.carts[username].reduce((total, item) => total + (item.price * item.quantity), 0);
            },
            
            // مدیریت سفارشات
            submitOrder(username, trackingNumber) {
                if (!this.carts[username] || this.carts[username].length === 0) {
                    return false;
                }
                
                const orderId = Date.now();
                this.orders[orderId] = {
                    id: orderId,
                    username: username,
                    items: [...this.carts[username]],
                    total: this.getCartTotal(username),
                    trackingNumber: trackingNumber,
                    status: 'pending',
                    adminMessage: '',
                    date: new Date().toLocaleString('fa-IR')
                };
                
                // پاک کردن سبد خرید پس از ثبت سفارش
                this.carts[username] = [];
                this.saveCarts();
                this.saveOrders();
                
                // ثبت فعالیت
                this.logUserActivity(username, 'ثبت سفارش', { orderId: orderId, total: this.orders[orderId].total });
                
                return orderId;
            },
            
            updateOrderStatus(orderId, status, adminMessage = '') {
                if (this.orders[orderId]) {
                    this.orders[orderId].status = status;
                    if (adminMessage) {
                        this.orders[orderId].adminMessage = adminMessage;
                    }
                    this.saveOrders();
                    
                    // ثبت فعالیت
                    this.logUserActivity('admin', 'تغییر وضعیت سفارش', { 
                        orderId: orderId, 
                        status: status,
                        username: this.orders[orderId].username
                    });
                    
                    return true;
                }
                return false;
            },
            
            // مدیریت کاربران
            addUser(username, password) {
                if (username.length < 3) {
                    return { success: false, message: 'نام کاربری باید حداقل ۳ کاراکتر باشد' };
                }
                
                if (password.length < 6) {
                    return { success: false, message: 'رمز عبور باید حداقل ۶ کاراکتر باشد' };
                }
                
                if (this.users.find(u => u.username === username)) {
                    return { success: false, message: 'این نام کاربری قبلاً استفاده شده است' };
                }
                
                this.users.push({ 
                    username, 
                    password: this.simpleHash(password),
                    registerDate: new Date().toLocaleString('fa-IR'),
                    lastActivity: new Date().toLocaleString('fa-IR')
                });
                this.saveUsers();
                
                // ثبت فعالیت
                this.logUserActivity('admin', 'افزودن کاربر', { username: username });
                
                return { success: true, message: 'کاربر با موفقیت اضافه شد' };
            },
            
            deleteUser(username) {
                // جلوگیری از حذف مدیر توسط خودش
                if (username === 'admin') {
                    return false;
                }
                
                this.users = this.users.filter(u => u.username !== username);
                delete this.carts[username];
                delete this.userProfiles[username];
                delete this.userActivity[username];
                this.saveUsers();
                this.saveCarts();
                this.saveUserProfiles();
                this.saveUserActivity();
                
                // ثبت فعالیت
                this.logUserActivity('admin', 'حذف کاربر', { username: username });
                
                return true;
            },
            
            // مدیریت تنظیمات سایت
            updateSiteSettings(title, logo) {
                this.siteSettings.title = title;
                if (logo) this.siteSettings.siteLogo = logo;
                this.saveSiteSettings();
                
                // ثبت فعالیت
                this.logUserActivity('admin', 'به‌روزرسانی تنظیمات سایت');
                
                return true;
            },
            
            // مدیریت کدهای سفارشی
            updateCustomCode(html, css, js) {
                this.customCode.html = html;
                this.customCode.css = css;
                this.customCode.js = js;
                this.saveCustomCode();
                
                // ثبت فعالیت
                this.logUserActivity('admin', 'به‌روزرسانی کدهای سفارشی');
                
                return true;
            },
            
            // مدیریت درباره ما
            updateAboutContent(logo, title, content) {
                this.aboutContent.logo = logo;
                this.aboutContent.title = title;
                this.aboutContent.content = content;
                this.saveAboutContent();
                
                // ثبت فعالیت
                this.logUserActivity('admin', 'به‌روزرسانی محتوای درباره ما');
                
                return true;
            },
            
            // مدیریت مشخصات محصولات
            addProductSpecs(productId, specs) {
                this.productSpecs[productId] = specs;
                this.saveProductSpecs();
                
                // ثبت فعالیت
                if (this.currentUser) {
                    const product = this.products.find(p => p.id === productId);
                    if (product) {
                        this.logUserActivity(this.currentUser.username, 'افزودن مشخصات محصول', { productName: product.name });
                    }
                }
            },
            
            getProductSpecs(productId) {
                return this.productSpecs[productId] || '';
            },
            
            // مدیریت نظرات محصولات
            addProductComment(productId, comment, username) {
                if (!this.productComments[productId]) {
                    this.productComments[productId] = [];
                }
                
                // بررسی اینکه کاربر قبلاً برای این محصول نظر داده یا نه
                if (this.hasUserCommented(productId, username)) {
                    return { success: false, message: 'شما قبلاً برای این محصول نظر داده‌اید' };
                }
                
                // بررسی وجود کلمات ممنوعه
                if (this.containsBannedWords(comment)) {
                    return { success: false, message: 'نظر شما حاوی کلمات نامناسب است' };
                }
                
                const newComment = {
                    id: Date.now(),
                    username: username,
                    comment: comment,
                    date: new Date().toLocaleString('fa-IR')
                };
                
                this.productComments[productId].push(newComment);
                
                // ثبت اینکه کاربر برای این محصول نظر داده
                if (!this.userComments[username]) {
                    this.userComments[username] = [];
                }
                this.userComments[username].push(productId);
                
                this.saveProductComments();
                this.saveUserComments();
                
                // ثبت فعالیت
                const product = this.products.find(p => p.id === productId);
                if (product) {
                    this.logUserActivity(username, 'ثبت نظر', { productName: product.name });
                }
                
                return { success: true, message: 'نظر شما با موفقیت ثبت شد' };
            },
            
            getProductComments(productId) {
                return this.productComments[productId] || [];
            },
            
            // تابع جدید برای دریافت تمام نظرات
            getAllComments() {
                const allComments = [];
                Object.keys(this.productComments).forEach(productId => {
                    const product = this.products.find(p => p.id === parseInt(productId));
                    if (product) {
                        this.productComments[productId].forEach(comment => {
                            allComments.push({
                                ...comment,
                                productId: parseInt(productId),
                                productName: product.name
                            });
                        });
                    }
                });
                return allComments;
            },
            
            // تابع جدید برای حذف نظر
            deleteComment(productId, commentId, currentUsername) {
                if (!this.productComments[productId]) {
                    return { success: false, message: 'نظر یافت نشد' };
                }
                
                const commentIndex = this.productComments[productId].findIndex(c => c.id === commentId);
                if (commentIndex === -1) {
                    return { success: false, message: 'نظر یافت نشد' };
                }
                
                const comment = this.productComments[productId][commentIndex];
                
                // بررسی مجوز حذف: کاربر می‌تواند نظر خودش را حذف کند، مدیر می‌تواند هر نظری را حذف کند
                if (comment.username !== currentUsername && !this.currentUser.isAdmin) {
                    return { success: false, message: 'شما مجوز حذف این نظر را ندارید' };
                }
                
                // حذف نظر
                this.productComments[productId].splice(commentIndex, 1);
                
                // اگر آرایه نظرات خالی شد، حذف آرایه
                if (this.productComments[productId].length === 0) {
                    delete this.productComments[productId];
                }
                
                // حذف از لیست نظرات کاربر
                if (this.userComments[comment.username]) {
                    const userCommentIndex = this.userComments[comment.username].indexOf(parseInt(productId));
                    if (userCommentIndex !== -1) {
                        this.userComments[comment.username].splice(userCommentIndex, 1);
                    }
                    
                    // اگر آرایه نظرات کاربر خالی شد، حذف آرایه
                    if (this.userComments[comment.username].length === 0) {
                        delete this.userComments[comment.username];
                    }
                }
                
                this.saveProductComments();
                this.saveUserComments();
                
                // ثبت فعالیت
                const product = this.products.find(p => p.id === productId);
                if (product) {
                    this.logUserActivity(currentUsername, 'حذف نظر', { productName: product.name });
                }
                
                return { success: true, message: 'نظر با موفقیت حذف شد' };
            },
            
            hasUserCommented(productId, username) {
                if (!this.userComments[username]) return false;
                return this.userComments[username].includes(productId);
            },
            
            containsBannedWords(text) {
                const lowerText = text.toLowerCase();
                return this.bannedWords.some(word => lowerText.includes(word.toLowerCase()));
            },
            
            // بررسی کامل بودن پروفایل کاربر
            isUserProfileComplete(username) {
                const profile = this.getUserProfile(username);
                return profile.firstName && profile.lastName && profile.phone && profile.address && profile.postalCode;
            },
            
            // سیستم جدید: همگام‌سازی با GitHub
            checkForUpdates() {
                const currentTime = Date.now();
                const timeSinceLastUpdate = currentTime - this.lastUpdate;
                
                if (timeSinceLastUpdate > this.updateCheckInterval) {
                    // شبیه‌سازی بررسی بروزرسانی
                    this.showUpdateNotification();
                    this.lastUpdate = currentTime;
                    localStorage.setItem('lastUpdate', this.lastUpdate);
                }
            },
            
            showUpdateNotification() {
                const notification = document.getElementById('update-notification');
                notification.classList.add('show');
            },
            
            applyUpdates() {
                // شبیه‌سازی اعمال بروزرسانی
                showMessage('بروزرسانی‌ها با موفقیت اعمال شد', 'success');
                location.reload();
            }
        };

        // توابع کمکی
        function showMessage(message, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = message;
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 5000);
        }

        function validateLoginForm() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            let isValid = true;
            
            if (username.length < 3) {
                document.getElementById('login-username-error').textContent = 'نام کاربری باید حداقل ۳ کاراکتر باشد';
                document.getElementById('login-username').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('login-username-error').textContent = '';
                document.getElementById('login-username').classList.remove('input-error');
            }
            
            if (password.length < 6) {
                document.getElementById('login-password-error').textContent = 'رمز عبور باید حداقل ۶ کاراکتر باشد';
                document.getElementById('login-password').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('login-password-error').textContent = '';
                document.getElementById('login-password').classList.remove('input-error');
            }
            
            return isValid;
        }

        function validateRegisterForm() {
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            let isValid = true;
            
            if (username.length < 3) {
                document.getElementById('register-username-error').textContent = 'نام کاربری باید حداقل ۳ کاراکتر باشد';
                document.getElementById('register-username').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('register-username-error').textContent = '';
                document.getElementById('register-username').classList.remove('input-error');
            }
            
            if (password.length < 6) {
                document.getElementById('register-password-error').textContent = 'رمز عبور باید حداقل ۶ کاراکتر باشد';
                document.getElementById('register-password').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('register-password-error').textContent = '';
                document.getElementById('register-password').classList.remove('input-error');
            }
            
            if (password !== confirmPassword) {
                document.getElementById('confirm-password-error').textContent = 'رمز عبور و تکرار آن مطابقت ندارند';
                document.getElementById('confirm-password').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('confirm-password-error').textContent = '';
                document.getElementById('confirm-password').classList.remove('input-error');
            }
            
            return isValid;
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function renderUserProducts() {
            const container = document.getElementById('user-products-list');
            container.innerHTML = '';
            
            if (AppState.products.length === 0) {
                container.innerHTML = '<div class="empty-state">هنوز محصولی برای نمایش وجود ندارد</div>';
                return;
            }
            
            AppState.products.forEach(product => {
                const productSpecs = AppState.getProductSpecs(product.id);
                const commentsCount = AppState.getProductComments(product.id).length;
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/300x200?text=بدون+عکس'}" 
                         alt="${product.name}" 
                         class="product-image" 
                         data-product-id="${product.id}">
                    <div class="product-details">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${product.price.toLocaleString()} تومان</div>
                        ${productSpecs ? `
                            <div class="product-specs">
                                <div class="specs-title">مشخصات:</div>
                                <div class="specs-content">${productSpecs}</div>
                            </div>
                        ` : ''}
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn btn-primary cart-btn" data-product-id="${product.id}">افزودن به سبد خرید</button>
                            <button class="btn btn-info btn-small view-details-btn" data-product-id="${product.id}">جزئیات و نظرات (${commentsCount})</button>
                        </div>
                    </div>
                `;
                container.appendChild(productCard);
            });
            
            // افزودن رویداد برای بزرگنمایی عکس
            document.querySelectorAll('.product-image').forEach(img => {
                img.addEventListener('click', function() {
                    const imageModal = document.getElementById('image-modal');
                    const expandedImage = document.getElementById('expanded-image');
                    expandedImage.src = this.src;
                    imageModal.style.display = 'flex';
                });
            });
            
            // افزودن رویداد برای افزودن به سبد خرید
            document.querySelectorAll('.cart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    if (AppState.addToCart(AppState.currentUser.username, productId)) {
                        showMessage('محصول به سبد خرید اضافه شد', 'success');
                        updateCartButton();
                    } else {
                        showMessage('خطا در افزودن محصول به سبد خرید', 'error');
                    }
                });
            });
            
            // افزودن رویداد برای نمایش جزئیات و نظرات محصول
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    showProductDetails(productId);
                });
            });
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items-container');
            container.innerHTML = '';
            
            const username = AppState.currentUser.username;
            const cartItems = AppState.carts[username] || [];
            
            if (cartItems.length === 0) {
                container.innerHTML = '<div class="empty-state">سبد خرید شما خالی است</div>';
                return;
            }
            
            cartItems.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-details">
                        <img src="${item.image || 'https://via.placeholder.com/80x80?text=بدون+عکس'}" 
                             alt="${item.name}" 
                             class="cart-item-image"
                             data-product-id="${item.id}">
                        <div>
                            <div class="product-name">${item.name}</div>
                            <div class="product-price">${item.price.toLocaleString()} تومان</div>
                            <div>تعداد: ${item.quantity}</div>
                        </div>
                    </div>
                    <button class="remove-item-btn" data-product-id="${item.id}">حذف</button>
                `;
                container.appendChild(cartItem);
            });
            
            // افزودن جمع کل
            const totalEl = document.createElement('div');
            totalEl.className = 'cart-total';
            totalEl.textContent = `جمع کل: ${AppState.getCartTotal(username).toLocaleString()} تومان`;
            container.appendChild(totalEl);
            
            // افزودن رویداد برای حذف از سبد خرید
            document.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    if (AppState.removeFromCart(username, productId)) {
                        showMessage('محصول از سبد خرید حذف شد', 'success');
                        renderCartItems();
                        updateCartButton();
                    } else {
                        showMessage('خطا در حذف محصول از سبد خرید', 'error');
                    }
                });
            });
            
            // افزودن رویداد برای بزرگنمایی عکس در سبد خرید
            document.querySelectorAll('.cart-item-image').forEach(img => {
                img.addEventListener('click', function() {
                    const imageModal = document.getElementById('image-modal');
                    const expandedImage = document.getElementById('expanded-image');
                    expandedImage.src = this.src;
                    imageModal.style.display = 'flex';
                });
            });
        }

        function renderOrderHistory() {
            const container = document.getElementById('order-history-list');
            container.innerHTML = '';
            
            const username = AppState.currentUser.username;
            const userOrders = Object.values(AppState.orders).filter(order => order.username === username);
            
            if (userOrders.length === 0) {
                container.innerHTML = '<div class="empty-state">هنوز سفارشی ثبت نکرده‌اید</div>';
                return;
            }
            
            // نمایش سفارشات به ترتیب تاریخ (جدیدترین اول)
            userOrders.sort((a, b) => b.id - a.id).forEach(order => {
                const orderEl = document.createElement('div');
                orderEl.className = 'order-history-item';
                orderEl.innerHTML = `
                    <div class="order-history-header">
                        <div>
                            <strong>سفارش شماره: ${order.id}</strong>
                            <div class="order-history-date">${order.date}</div>
                        </div>
                        <span class="order-status status-${order.status}">${getStatusText(order.status)}</span>
                    </div>
                    <div class="order-details">
                        <div class="order-details-item">
                            <span>مبلغ کل:</span>
                            <span>${order.total.toLocaleString()} تومان</span>
                        </div>
                        <div class="order-details-item">
                            <span>شماره پیگیری/ارجاع:</span>
                            <span>${order.trackingNumber}</span>
                        </div>
                        ${order.adminMessage ? `
                            <div class="order-details-item">
                                <span>پیام مدیر:</span>
                                <span>${order.adminMessage}</span>
                            </div>
                        ` : ''}
                        <div class="order-details-item">
                            <span>تعداد محصولات:</span>
                            <span>${order.items.length} محصول</span>
                        </div>
                    </div>
                    <div class="order-products-images">
                        ${order.items.map(item => `
                            <img src="${item.image || 'https://via.placeholder.com/40x40?text=بدون+عکس'}" 
                                 alt="${item.name}" 
                                 class="order-product-thumb"
                                 title="${item.name}">
                        `).join('')}
                    </div>
                `;
                container.appendChild(orderEl);
            });
            
            // افزودن رویداد برای بزرگنمایی عکس‌های محصولات در تاریخچه سفارشات
            document.querySelectorAll('.order-product-thumb').forEach(img => {
                img.addEventListener('click', function() {
                    const imageModal = document.getElementById('image-modal');
                    const expandedImage = document.getElementById('expanded-image');
                    expandedImage.src = this.src;
                    imageModal.style.display = 'flex';
                });
            });
        }

        function renderAdminProducts() {
            const container = document.getElementById('admin-products-list');
            container.innerHTML = '';
            
            if (AppState.products.length === 0) {
                container.innerHTML = '<div class="empty-state">هنوز محصولی اضافه نکرده‌اید</div>';
                return;
            }
            
            AppState.products.forEach(product => {
                const productSpecs = AppState.getProductSpecs(product.id);
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/300x200?text=بدون+عکس'}" 
                         alt="${product.name}" 
                         class="product-image"
                         data-product-id="${product.id}">
                    <div class="product-details">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${product.price.toLocaleString()} تومان</div>
                        ${productSpecs ? `
                            <div class="product-specs">
                                <div class="specs-title">مشخصات:</div>
                                <div class="specs-content">${productSpecs}</div>
                            </div>
                        ` : ''}
                        <div class="product-actions">
                            <button class="btn btn-warning btn-small edit-product" data-product-id="${product.id}">ویرایش</button>
                            <button class="btn btn-secondary btn-small delete-product" data-product-id="${product.id}">حذف</button>
                        </div>
                    </div>
                `;
                container.appendChild(productCard);
            });
            
            // افزودن رویداد برای ویرایش محصول
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    // پیاده‌سازی ویرایش محصول
                    showMessage('قابلیت ویرایش محصول به زودی اضافه خواهد شد', 'info');
                });
            });
            
            // افزودن رویداد برای حذف محصول
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    const product = AppState.products.find(p => p.id === productId);
                    
                    if (product && confirm(`آیا از حذف محصول "${product.name}" اطمینان دارید؟`)) {
                        if (AppState.deleteProduct(productId)) {
                            showMessage('محصول با موفقیت حذف شد', 'success');
                            renderAdminProducts();
                            renderUserProducts();
                        } else {
                            showMessage('خطا در حذف محصول', 'error');
                        }
                    }
                });
            });
        }

        function renderAdminOrders() {
            const container = document.getElementById('admin-orders-list');
            container.innerHTML = '';
            
            if (Object.keys(AppState.orders).length === 0) {
                container.innerHTML = '<div class="empty-state">هنوز سفارشی ثبت نشده است</div>';
                return;
            }
            
            // نمایش سفارشات به ترتیب تاریخ (جدیدترین اول)
            Object.values(AppState.orders).sort((a, b) => b.id - a.id).forEach(order => {
                const orderEl = document.createElement('div');
                orderEl.className = 'admin-order-item';
                orderEl.innerHTML = `
                    <div><strong>کاربر:</strong> ${order.username}</div>
                    <div><strong>تاریخ:</strong> ${order.date}</div>
                    <div><strong>مبلغ کل:</strong> ${order.total.toLocaleString()} تومان</div>
                    <div><strong>شماره پیگیری/ارجاع:</strong> ${order.trackingNumber || 'ثبت نشده'}</div>
                    <div><strong>وضعیت:</strong> <span class="order-status status-${order.status}">${getStatusText(order.status)}</span></div>
                    <div class="admin-cart-items">
                        <strong>محصولات:</strong>
                        ${order.items.map(item => `
                            <div class="admin-cart-item">
                                <span>${item.name} - ${item.price.toLocaleString()} تومان (${item.quantity} عدد)</span>
                            </div>
                        `).join('')}
                    </div>
                    ${order.status === 'pending' ? `
                        <div class="admin-order-actions">
                            <textarea class="admin-message-input" id="admin-message-${order.id}" placeholder="پیام برای کاربر...">${order.adminMessage || ''}</textarea>
                            <button class="btn btn-success confirm-order" data-order-id="${order.id}">تایید سفارش</button>
                        </div>
                    ` : `
                        <div><strong>پیام مدیر:</strong> ${order.adminMessage || 'بدون پیام'}</div>
                    `}
                `;
                container.appendChild(orderEl);
            });
            
            // افزودن رویداد برای تایید سفارش
            document.querySelectorAll('.confirm-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = parseInt(this.getAttribute('data-order-id'));
                    const messageInput = document.getElementById(`admin-message-${orderId}`);
                    const adminMessage = messageInput.value.trim() || 'پرداخت شما موفقیت‌آمیز بود. محصول شما از طریق پست یا تیپاکس برایتان ارسال می‌شود.';
                    
                    if (AppState.updateOrderStatus(orderId, 'confirmed', adminMessage)) {
                        showMessage('سفارش با موفقیت تایید شد', 'success');
                        renderAdminOrders();
                    } else {
                        showMessage('خطا در تایید سفارش', 'error');
                    }
                });
            });
        }

        // تابع جدید برای نمایش مدیریت نظرات
        function renderAdminComments() {
            const container = document.getElementById('admin-comments-list');
            container.innerHTML = '';
            
            const allComments = AppState.getAllComments();
            
            if (allComments.length === 0) {
                container.innerHTML = '<div class="empty-state">هنوز نظری ثبت نشده است</div>';
                return;
            }
            
            // نمایش نظرات به ترتیب تاریخ (جدیدترین اول)
            allComments.sort((a, b) => b.id - a.id).forEach(comment => {
                const commentEl = document.createElement('div');
                commentEl.className = 'admin-comment-item';
                commentEl.innerHTML = `
                    <div class="admin-comment-header">
                        <div>
                            <span class="comment-author">${comment.username}</span>
                            <span class="comment-date">${comment.date}</span>
                        </div>
                        <div class="admin-comment-product">محصول: ${comment.productName}</div>
                    </div>
                    <div class="comment-content">${comment.comment}</div>
                    <button class="admin-delete-comment-btn" 
                            data-product-id="${comment.productId}" 
                            data-comment-id="${comment.id}">
                        حذف نظر
                    </button>
                `;
                container.appendChild(commentEl);
            });
            
            // افزودن رویداد برای حذف نظر توسط مدیر
            document.querySelectorAll('.admin-delete-comment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    const commentId = parseInt(this.getAttribute('data-comment-id'));
                    
                    if (confirm('آیا از حذف این نظر اطمینان دارید؟')) {
                        const result = AppState.deleteComment(productId, commentId, AppState.currentUser.username);
                        if (result.success) {
                            showMessage(result.message, 'success');
                            renderAdminComments();
                            // به‌روزرسانی نمایش محصولات در صورت نیاز
                            if (AppState.currentUser && !AppState.currentUser.isAdmin) {
                                renderUserProducts();
                            }
                        } else {
                            showMessage(result.message, 'error');
                        }
                    }
                });
            });
        }

        // تابع جدید برای نمایش فعالیت کاربران
        function renderUserActivities() {
            const container = document.getElementById('user-activity-list');
            container.innerHTML = '';
            
            const allActivities = AppState.getAllUserActivities();
            
            if (allActivities.length === 0) {
                container.innerHTML = '<div class="empty-state">هنوز فعالیتی ثبت نشده است</div>';
                return;
            }
            
            // نمایش فعالیت‌ها به ترتیب تاریخ (جدیدترین اول)
            allActivities.forEach(activity => {
                const activityEl = document.createElement('div');
                activityEl.className = 'user-activity-log';
                activityEl.innerHTML = `
                    <div class="activity-item">
                        <div><strong>کاربر:</strong> ${activity.username}</div>
                        <div><strong>فعالیت:</strong> ${activity.action}</div>
                        ${activity.details && Object.keys(activity.details).length > 0 ? `
                            <div><strong>جزئیات:</strong> ${JSON.stringify(activity.details)}</div>
                        ` : ''}
                        <div class="activity-time">${activity.timestamp}</div>
                    </div>
                `;
                container.appendChild(activityEl);
            });
        }

        function renderUsersList() {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '';
            
            AppState.users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.registerDate}</td>
                    <td>${user.lastActivity || 'بدون فعالیت'}</td>
                    <td>
                        <button class="btn btn-warning btn-small edit-user-btn" data-username="${user.username}">ویرایش</button>
                        <button class="btn btn-info btn-small view-user-details" data-username="${user.username}">مشخصات</button>
                        ${user.username !== 'admin' ? `
                            <button class="btn btn-secondary btn-small delete-user" data-username="${user.username}">حذف</button>
                        ` : ''}
                    </td>
                `;
                usersList.appendChild(row);
            });
            
            // افزودن رویداد برای ویرایش کاربر
            document.querySelectorAll('.edit-user-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    openEditUserModal(username);
                });
            });
            
            // افزودن رویداد برای مشاهده مشخصات کاربر
            document.querySelectorAll('.view-user-details').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    showUserDetails(username);
                });
            });
            
            // افزودن رویداد برای حذف کاربر
            document.querySelectorAll('.delete-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    if (confirm(`آیا از حذف کاربر "${username}" اطمینان دارید؟`)) {
                        if (AppState.deleteUser(username)) {
                            showMessage('کاربر با موفقیت حذف شد', 'success');
                            renderUsersList();
                        } else {
                            showMessage('خطا در حذف کاربر', 'error');
                        }
                    }
                });
            });
        }

        function openEditUserModal(username) {
            document.getElementById('edit-username').value = username;
            document.getElementById('edit-password').value = '';
            
            const modal = document.getElementById('edit-user-modal');
            modal.style.display = 'flex';
            
            // ذخیره نام کاربری فعلی برای استفاده در تابع ذخیره
            modal.setAttribute('data-current-username', username);
        }

        function showUserDetails(username) {
            const userProfile = AppState.getUserProfile(username);
            const user = AppState.users.find(u => u.username === username);
            const userActivities = AppState.getUserActivity(username);
            
            const content = document.getElementById('user-details-content');
            content.innerHTML = `
                <div class="user-detail-item">
                    <span class="user-detail-label">نام کاربری:</span>
                    <span class="user-detail-value">${username}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">تاریخ ثبت‌نام:</span>
                    <span class="user-detail-value">${user.registerDate}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">آخرین فعالیت:</span>
                    <span class="user-detail-value">${user.lastActivity || 'بدون فعالیت'}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">نام:</span>
                    <span class="user-detail-value">${userProfile.firstName || 'ثبت نشده'}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">نام خانوادگی:</span>
                    <span class="user-detail-value">${userProfile.lastName || 'ثبت نشده'}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">شماره تماس:</span>
                    <span class="user-detail-value">${userProfile.phone || 'ثبت نشده'}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">کد پستی:</span>
                    <span class="user-detail-value">${userProfile.postalCode || 'ثبت نشده'}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">آدرس:</span>
                    <span class="user-detail-value">${userProfile.address || 'ثبت نشده'}</span>
                </div>
                <div class="user-detail-item">
                    <span class="user-detail-label">آخرین به‌روزرسانی:</span>
                    <span class="user-detail-value">${userProfile.lastUpdate || 'ثبت نشده'}</span>
                </div>
                ${userActivities.length > 0 ? `
                    <div class="user-activity-log" style="margin-top: 20px;">
                        <h4>آخرین فعالیت‌ها:</h4>
                        ${userActivities.slice(0, 5).map(activity => `
                            <div class="activity-item">
                                <div>${activity.action}</div>
                                <div class="activity-time">${activity.timestamp}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            const modal = document.getElementById('user-details-modal');
            modal.style.display = 'flex';
        }

        function loadUserProfile() {
            if (!AppState.currentUser || AppState.currentUser.isAdmin) return;
            
            const username = AppState.currentUser.username;
            const profile = AppState.getUserProfile(username);
            
            document.getElementById('first-name').value = profile.firstName || '';
            document.getElementById('last-name').value = profile.lastName || '';
            document.getElementById('phone').value = profile.phone || '';
            document.getElementById('postal-code').value = profile.postalCode || '';
            document.getElementById('address').value = profile.address || '';
            
            // بررسی کامل بودن پروفایل هنگام بارگذاری
            checkProfileCompletion();
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'در انتظار تایید';
                case 'confirmed': return 'تایید شده';
                case 'shipped': return 'ارسال شده';
                default: return status;
            }
        }

        function updateCartButton() {
            const username = AppState.currentUser ? AppState.currentUser.username : '';
            const cartItems = AppState.carts[username] || [];
            const cartBtn = document.getElementById('cart-btn');
            
            if (cartItems.length > 0) {
                cartBtn.textContent = `سبد خرید (${cartItems.length})`;
            } else {
                cartBtn.textContent = 'سبد خرید';
            }
        }

        // بخش اصلاح شده برای لیست افزودن کالا
        function initializeBulkProductInputs() {
            const container = document.getElementById('bulk-product-inputs');
            container.innerHTML = '';
            
            // ایجاد 10 ردیف اولیه برای ورود محصولات
            for (let i = 0; i < 10; i++) {
                addProductRow();
            }
        }

        function addProductRow() {
            const container = document.getElementById('bulk-product-inputs');
            const row = document.createElement('div');
            row.className = 'product-input-row';
            row.innerHTML = `
                <input type="text" placeholder="نام محصول" class="product-name-input">
                <input type="number" placeholder="قیمت محصول به تومان" class="product-price-input">
                <textarea class="specs-input" placeholder="مشخصات محصول"></textarea>
                <div class="image-upload-container">
                    <input type="file" class="product-image-input" accept="image/*">
                    <label for="product-image-input" class="file-input-label">انتخاب عکس محصول</label>
                    <div class="image-preview-container">
                        <img class="preview-image" alt="پیش‌نمایش عکس">
                        <button type="button" class="remove-image-btn">&times;</button>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary remove-product-row">حذف محصول</button>
            `;
            container.appendChild(row);
            
            // افزودن رویداد برای نمایش پیش‌نمایش عکس
            const imageInput = row.querySelector('.product-image-input');
            const previewImage = row.querySelector('.preview-image');
            const removeImageBtn = row.querySelector('.remove-image-btn');
            const imagePreviewContainer = row.querySelector('.image-preview-container');
            
            imageInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        imagePreviewContainer.style.display = 'block';
                    }
                    
                    reader.readAsDataURL(this.files[0]);
                }
            });
            
            // افزودن رویداد برای حذف عکس
            removeImageBtn.addEventListener('click', function() {
                imageInput.value = '';
                previewImage.src = '';
                imagePreviewContainer.style.display = 'none';
            });
            
            // افزودن رویداد برای حذف ردیف محصول
            const removeProductBtn = row.querySelector('.remove-product-row');
            removeProductBtn.addEventListener('click', function() {
                row.remove();
            });
        }

        function loadSiteSettings() {
            // بارگذاری عنوان سایت
            document.getElementById('site-title').textContent = AppState.siteSettings.title;
            document.getElementById('site-title-input').value = AppState.siteSettings.title;
            
            // بارگذاری لوگو سایت
            if (AppState.siteSettings.siteLogo) {
                document.getElementById('site-logo').src = AppState.siteSettings.siteLogo;
                document.getElementById('current-site-logo').innerHTML = `
                    <img src="${AppState.siteSettings.siteLogo}" class="current-image" alt="لوگو فعلی">
                `;
            }
            
            // بارگذاری درباره ما
            document.getElementById('about-title-input').value = AppState.aboutContent.title;
            document.getElementById('about-content-input').value = AppState.aboutContent.content;
            
            if (AppState.aboutContent.logo) {
                document.getElementById('current-about-logo').innerHTML = `
                    <img src="${AppState.aboutContent.logo}" class="current-image" alt="لوگوی درباره ما">
                `;
            }
            
            // بارگذاری کدهای سفارشی
            document.getElementById('custom-html').value = AppState.customCode.html;
            document.getElementById('custom-css').value = AppState.customCode.css;
            document.getElementById('custom-js').value = AppState.customCode.js;
            
            // نمایش درباره ما برای کاربران
            renderAboutSection();
        }

        function renderAboutSection() {
            const aboutSection = document.getElementById('user-about-section');
            aboutSection.innerHTML = `
                <div class="about-header">
                    ${AppState.aboutContent.logo ? `<img src="${AppState.aboutContent.logo}" class="about-logo" alt="لوگو">` : ''}
                    <div class="about-title">${AppState.aboutContent.title}</div>
                </div>
                <div class="about-content">${AppState.aboutContent.content}</div>
            `;
        }

        function applyCustomCode() {
            // اعمال کد HTML سفارشی
            if (AppState.customCode.html) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = AppState.customCode.html;
                document.body.appendChild(tempDiv);
            }
            
            // اعمال کد CSS سفارشی
            if (AppState.customCode.css) {
                const style = document.createElement('style');
                style.textContent = AppState.customCode.css;
                document.head.appendChild(style);
            }
            
            // اعمال کد JS سفارشی
            if (AppState.customCode.js) {
                try {
                    eval(AppState.customCode.js);
                } catch (e) {
                    console.error('خطا در اجرای کد JavaScript سفارشی:', e);
                }
            }
        }

        function setupLogoutButtons() {
            // فقط یک دکمه خروج در هدر وجود دارد
            document.getElementById('logout-btn').addEventListener('click', function() {
                AppState.currentUser = null;
                localStorage.removeItem('currentUser');
                showPage('auth-page');
                updateUI();
            });
        }

        function updateUI() {
            if (AppState.currentUser) {
                if (AppState.currentUser.isAdmin) {
                    showPage('admin-page');
                    document.getElementById('logout-btn').style.display = 'block';
                    document.getElementById('cart-btn').style.display = 'none';
                    document.getElementById('profile-btn').style.display = 'none';
                    renderAdminProducts();
                    renderAdminOrders();
                    renderUsersList();
                    renderAdminComments();
                    renderUserActivities();
                } else {
                    showPage('user-page');
                    document.getElementById('username-display').textContent = AppState.currentUser.username;
                    document.getElementById('logout-btn').style.display = 'block';
                    document.getElementById('cart-btn').style.display = 'block';
                    document.getElementById('profile-btn').style.display = 'block';
                    renderUserProducts();
                    updateCartButton();
                    loadUserProfile();
                }
            } else {
                showPage('auth-page');
                document.getElementById('logout-btn').style.display = 'none';
                document.getElementById('cart-btn').style.display = 'none';
                document.getElementById('profile-btn').style.display = 'none';
            }
        }

        // توابع جدید برای مدیریت مشخصات محصولات و نظرات
        function showProductDetails(productId) {
            const product = AppState.products.find(p => p.id === productId);
            if (!product) return;
            
            const productSpecs = AppState.getProductSpecs(productId);
            const comments = AppState.getProductComments(productId);
            const hasCommented = AppState.currentUser ? AppState.hasUserCommented(productId, AppState.currentUser.username) : false;
            
            const content = document.getElementById('product-details-content');
            content.innerHTML = `
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <img src="${product.image || 'https://via.placeholder.com/300x200?text=بدون+عکس'}" 
                         alt="${product.name}" 
                         style="width: 200px; height: 150px; object-fit: cover; border-radius: 10px;">
                    <div>
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">${product.name}</h3>
                        <div style="font-size: 22px; font-weight: bold; color: #e74c3c; margin-bottom: 10px;">${product.price.toLocaleString()} تومان</div>
                        ${productSpecs ? `
                            <div class="product-specs">
                                <div class="specs-title">مشخصات محصول:</div>
                                <div class="specs-content">${productSpecs}</div>
                            </div>
                        ` : '<p>بدون مشخصات</p>'}
                    </div>
                </div>
                
                <div class="comments-section">
                    <div class="comments-title">نظرات کاربران (${comments.length})</div>
                    
                    ${AppState.currentUser && !AppState.currentUser.isAdmin ? `
                        ${hasCommented ? 
                            '<p style="color: #27ae60; text-align: center;">شما قبلاً برای این محصول نظر داده‌اید</p>' : 
                            `<div class="comment-form">
                                <textarea class="comment-input" id="new-comment-text" placeholder="نظر خود را درباره این محصول بنویسید..."></textarea>
                                <button class="btn btn-primary" id="submit-comment" data-product-id="${productId}">ثبت نظر</button>
                            </div>`
                        }
                    ` : ''}
                    
                    <div id="comments-list">
                        ${comments.length > 0 ? 
                            comments.map(comment => `
                                <div class="comment-item">
                                    ${AppState.currentUser && (AppState.currentUser.isAdmin || AppState.currentUser.username === comment.username) ? `
                                        <button class="delete-comment-btn" 
                                                data-product-id="${productId}" 
                                                data-comment-id="${comment.id}">
                                            حذف
                                        </button>
                                    ` : ''}
                                    <div class="comment-header">
                                        <span class="comment-author">${comment.username}</span>
                                        <span class="comment-date">${comment.date}</span>
                                    </div>
                                    <div class="comment-content">${comment.comment}</div>
                                </div>
                            `).join('') : 
                            '<div class="no-comments">هنوز نظری برای این محصول ثبت نشده است</div>'
                        }
                    </div>
                </div>
            `;
            
            const modal = document.getElementById('product-details-modal');
            modal.style.display = 'flex';
            
            // افزودن رویداد برای ثبت نظر
            if (AppState.currentUser && !AppState.currentUser.isAdmin && !hasCommented) {
                document.getElementById('submit-comment').addEventListener('click', function() {
                    const commentText = document.getElementById('new-comment-text').value.trim();
                    if (!commentText) {
                        showMessage('لطفاً نظر خود را وارد کنید', 'error');
                        return;
                    }
                    
                    const result = AppState.addProductComment(productId, commentText, AppState.currentUser.username);
                    if (result.success) {
                        showMessage(result.message, 'success');
                        modal.style.display = 'none';
                        renderUserProducts(); // به‌روزرسانی نمایش تعداد نظرات
                    } else {
                        showMessage(result.message, 'error');
                    }
                });
            }
            
            // افزودن رویداد برای حذف نظر توسط کاربر یا مدیر
            document.querySelectorAll('.delete-comment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    const commentId = parseInt(this.getAttribute('data-comment-id'));
                    
                    if (confirm('آیا از حذف این نظر اطمینان دارید؟')) {
                        const result = AppState.deleteComment(productId, commentId, AppState.currentUser.username);
                        if (result.success) {
                            showMessage(result.message, 'success');
                            modal.style.display = 'none';
                            // به‌روزرسانی نمایش محصولات
                            renderUserProducts();
                        } else {
                            showMessage(result.message, 'error');
                        }
                    }
                });
            });
        }

        function checkProfileCompletion() {
            if (!AppState.currentUser || AppState.currentUser.isAdmin) return true;
            
            const isComplete = AppState.isUserProfileComplete(AppState.currentUser.username);
            const warningElement = document.getElementById('profile-warning');
            const submitButton = document.getElementById('submit-tracking');
            
            if (!isComplete) {
                warningElement.style.display = 'block';
                submitButton.disabled = true;
                submitButton.style.opacity = '0.6';
                return false;
            } else {
                warningElement.style.display = 'none';
                submitButton.disabled = false;
                submitButton.style.opacity = '1';
                return true;
            }
        }

        // توابع جدید برای جستجو و فیلتر
        function setupSearchAndFilter() {
            // جستجوی محصولات
            document.getElementById('product-search').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                filterProducts(searchTerm);
            });
            
            // فیلتر قیمت
            document.getElementById('price-filter').addEventListener('change', function(e) {
                filterProductsByPrice(e.target.value);
            });
            
            // پاک کردن فیلترها
            document.getElementById('clear-filters').addEventListener('click', function() {
                document.getElementById('product-search').value = '';
                document.getElementById('price-filter').value = '';
                renderUserProducts();
                renderAdminProducts();
            });
        }

        function filterProducts(searchTerm) {
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const productName = card.querySelector('.product-name').textContent.toLowerCase();
                const productSpecs = card.querySelector('.specs-content')?.textContent.toLowerCase() || '';
                
                if (productName.includes(searchTerm) || productSpecs.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterProductsByPrice(priceRange) {
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const priceText = card.querySelector('.product-price').textContent;
                const price = parseInt(priceText.replace(/[^0-9]/g, ''));
                
                let shouldShow = true;
                
                switch(priceRange) {
                    case '0-50000':
                        shouldShow = price <= 50000;
                        break;
                    case '50000-200000':
                        shouldShow = price > 50000 && price <= 200000;
                        break;
                    case '200000-500000':
                        shouldShow = price > 200000 && price <= 500000;
                        break;
                    case '500000+':
                        shouldShow = price > 500000;
                        break;
                    default:
                        shouldShow = true;
                }
                
                card.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // رویدادهای کلیک و سایر تعاملات
        document.addEventListener('DOMContentLoaded', function() {
            // بارگذاری تنظیمات سایت
            loadSiteSettings();
            applyCustomCode();
            
            // تنظیم وضعیت اولیه UI
            updateUI();
            
            // راه‌اندازی سیستم جستجو و فیلتر
            setupSearchAndFilter();
            
            // رویدادهای تب‌های فرم احراز هویت
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.getElementById('login-form').style.display = tabName === 'login' ? 'block' : 'none';
                    document.getElementById('register-form').style.display = tabName === 'register' ? 'block' : 'none';
                });
            });
            
            // رویدادهای تب‌های پنل مدیریت
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.admin-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabName).classList.add('active');
                    
                    // اگر تب مدیریت محصولات فعال شد، محصولات را رندر کن
                    if (tabName === 'products-management') {
                        renderAdminProducts();
                    }
                    
                    // اگر تب مدیریت سفارشات فعال شد، سفارشات را رندر کن
                    if (tabName === 'orders-management') {
                        renderAdminOrders();
                    }
                    
                    // اگر تب مدیریت کاربران فعال شد، کاربران را رندر کن
                    if (tabName === 'users-management') {
                        renderUsersList();
                    }
                    
                    // اگر تب مدیریت نظرات فعال شد، نظرات را رندر کن
                    if (tabName === 'comments-management') {
                        renderAdminComments();
                    }
                    
                    // اگر تب مدیریت فعالیت‌ها فعال شد، فعالیت‌ها را رندر کن
                    if (tabName === 'activity-management') {
                        renderUserActivities();
                    }
                });
            });
            
            // رویداد ورود
            document.getElementById('login-btn').addEventListener('click', function() {
                if (!validateLoginForm()) return;
                
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                
                if (AppState.loginUser(username, password)) {
                    showMessage('ورود موفقیت‌آمیز بود', 'success');
                    updateUI();
                } else {
                    showMessage('نام کاربری یا رمز عبور نادرست است', 'error');
                }
            });
            
            // رویداد ثبت‌نام
            document.getElementById('register-btn').addEventListener('click', function() {
                if (!validateRegisterForm()) return;
                
                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value;
                
                const result = AppState.registerUser(username, password);
                if (result.success) {
                    showMessage(result.message, 'success');
                    
                    // تغییر به تب ورود
                    document.querySelector('.auth-tab[data-tab="login"]').click();
                    document.getElementById('login-username').value = username;
                } else {
                    showMessage(result.message, 'error');
                }
            });
            
            // رویداد نمایش سبد خرید
            document.getElementById('cart-btn').addEventListener('click', function() {
                showPage('cart-page');
                renderCartItems();
                renderOrderHistory();
                checkProfileCompletion(); // بررسی کامل بودن پروفایل
            });
            
            // رویداد نمایش پروفایل
            document.getElementById('profile-btn').addEventListener('click', function() {
                showPage('profile-page');
            });
            
            // رویداد بازگشت به محصولات از سبد خرید
            document.getElementById('back-to-products').addEventListener('click', function() {
                showPage('user-page');
            });
            
            // رویداد بازگشت به محصولات از پروفایل
            document.getElementById('back-to-products-from-profile').addEventListener('click', function() {
                showPage('user-page');
            });
            
            // رویداد ثبت شماره پیگیری
            document.getElementById('submit-tracking').addEventListener('click', function() {
                // بررسی کامل بودن پروفایل قبل از ثبت سفارش
                if (!checkProfileCompletion()) {
                    showMessage('لطفاً ابتدا مشخصات شخصی خود را در بخش پروفایل تکمیل کنید', 'error');
                    return;
                }
                
                const trackingNumber = document.getElementById('tracking-number').value.trim();
                
                if (!trackingNumber) {
                    showMessage('لطفاً شماره پیگیری یا ارجاع را وارد کنید', 'error');
                    return;
                }
                
                const orderId = AppState.submitOrder(AppState.currentUser.username, trackingNumber);
                if (orderId) {
                    showMessage('شماره پیگیری با موفقیت ثبت شد', 'success');
                    document.getElementById('tracking-number').value = '';
                    renderCartItems();
                    updateCartButton();
                    renderOrderHistory();
                } else {
                    showMessage('خطا در ثبت شماره پیگیری', 'error');
                }
            });
            
            // رویداد افزودن ردیف محصول
            document.getElementById('add-product-row').addEventListener('click', function() {
                addProductRow();
            });
            
            // رویداد افزودن محصولات
            document.getElementById('add-products').addEventListener('click', function() {
                const productRows = document.querySelectorAll('.product-input-row');
                const productsData = [];
                
                productRows.forEach(row => {
                    const nameInput = row.querySelector('.product-name-input');
                    const priceInput = row.querySelector('.product-price-input');
                    const imageInput = row.querySelector('.product-image-input');
                    const specsInput = row.querySelector('.specs-input');
                    
                    const name = nameInput.value.trim();
                    const price = priceInput.value.trim();
                    const specs = specsInput.value.trim();
                    
                    if (name && price) {
                        const productData = { name, price, specs };
                        
                        // پردازش تصویر اگر آپلود شده باشد
                        if (imageInput.files.length > 0) {
                            const file = imageInput.files[0];
                            const reader = new FileReader();
                            
                            reader.onload = function(e) {
                                productData.image = e.target.result;
                            };
                            
                            reader.readAsDataURL(file);
                        }
                        
                        productsData.push(productData);
                    }
                });
                
                if (productsData.length === 0) {
                    showMessage('لطفاً حداقل یک محصول با نام و قیمت وارد کنید', 'error');
                    return;
                }
                
                // صبر کردن برای بارگذاری تصاویر
                setTimeout(() => {
                    const addedProducts = [];
                    productsData.forEach(data => {
                        if (data.name && data.price) {
                            const product = AppState.addProduct(data.name, data.price, data.image || '');
                            
                            // ذخیره مشخصات محصول اگر وارد شده باشد
                            if (data.specs) {
                                AppState.addProductSpecs(product.id, data.specs);
                            }
                            
                            addedProducts.push(product);
                        }
                    });
                    
                    showMessage(`${addedProducts.length} محصول با موفقیت اضافه شد`, 'success');
                    
                    // پاک کردن فیلدها
                    productRows.forEach(row => {
                        row.querySelector('.product-name-input').value = '';
                        row.querySelector('.product-price-input').value = '';
                        row.querySelector('.product-image-input').value = '';
                        row.querySelector('.specs-input').value = '';
                        const previewImage = row.querySelector('.preview-image');
                        previewImage.style.display = 'none';
                        previewImage.src = '';
                    });
                    
                    // رندر مجدد محصولات
                    renderUserProducts();
                    renderAdminProducts();
                }, 500);
            });
            
            // رویداد افزودن کاربر
            document.getElementById('add-user').addEventListener('click', function() {
                const username = document.getElementById('new-username').value.trim();
                const password = document.getElementById('new-password').value;
                
                const result = AppState.addUser(username, password);
                if (result.success) {
                    showMessage(result.message, 'success');
                    document.getElementById('new-username').value = '';
                    document.getElementById('new-password').value = '';
                    
                    // رندر مجدد لیست کاربران
                    renderUsersList();
                } else {
                    showMessage(result.message, 'error');
                }
            });
            
            // رویداد ذخیره ویرایش کاربر
            document.getElementById('save-user-edit').addEventListener('click', function() {
                const modal = document.getElementById('edit-user-modal');
                const currentUsername = modal.getAttribute('data-current-username');
                const newUsername = document.getElementById('edit-username').value.trim();
                const newPassword = document.getElementById('edit-password').value;
                
                if (!newUsername) {
                    showMessage('نام کاربری نمی‌تواند خالی باشد', 'error');
                    return;
                }
                
                const result = AppState.updateUser(currentUsername, newUsername, newPassword || null);
                if (result.success) {
                    showMessage(result.message, 'success');
                    modal.style.display = 'none';
                    renderUsersList();
                } else {
                    showMessage(result.message, 'error');
                }
            });
            
            // رویداد ذخیره پروفایل کاربر
            document.getElementById('profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const profileData = {
                    firstName: document.getElementById('first-name').value.trim(),
                    lastName: document.getElementById('last-name').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    postalCode: document.getElementById('postal-code').value.trim(),
                    address: document.getElementById('address').value.trim()
                };
                
                if (AppState.updateUserProfile(AppState.currentUser.username, profileData)) {
                    showMessage('مشخصات کاربری با موفقیت ذخیره شد', 'success');
                    checkProfileCompletion(); // بررسی کامل بودن پروفایل پس از ذخیره
                } else {
                    showMessage('خطا در ذخیره مشخصات کاربری', 'error');
                }
            });
            
            // رویداد ذخیره تنظیمات سایت
            document.getElementById('save-site-settings').addEventListener('click', function() {
                const title = document.getElementById('site-title-input').value.trim();
                const logoInput = document.getElementById('site-logo-input');
                
                let logo = AppState.siteSettings.siteLogo;
                
                // پردازش لوگو اگر آپلود شده باشد
                if (logoInput.files.length > 0) {
                    const file = logoInput.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        logo = e.target.result;
                        AppState.updateSiteSettings(title, logo);
                        showMessage('تنظیمات سایت با موفقیت ذخیره شد', 'success');
                        loadSiteSettings();
                    };
                    
                    reader.readAsDataURL(file);
                } else {
                    AppState.updateSiteSettings(title, logo);
                    showMessage('تنظیمات سایت با موفقیت ذخیره شد', 'success');
                    loadSiteSettings();
                }
            });
            
            // رویداد ذخیره کدهای سفارشی
            document.getElementById('save-custom-code').addEventListener('click', function() {
                const html = document.getElementById('custom-html').value;
                const css = document.getElementById('custom-css').value;
                const js = document.getElementById('custom-js').value;
                
                AppState.updateCustomCode(html, css, js);
                showMessage('کدهای سفارشی با موفقیت ذخیره شد', 'success');
                applyCustomCode();
            });
            
            // رویداد ذخیره درباره ما
            document.getElementById('save-about-content').addEventListener('click', function() {
                const title = document.getElementById('about-title-input').value.trim();
                const content = document.getElementById('about-content-input').value.trim();
                const logoInput = document.getElementById('about-logo-input');
                
                let logo = AppState.aboutContent.logo;
                
                // پردازش لوگو اگر آپلود شده باشد
                if (logoInput.files.length > 0) {
                    const file = logoInput.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        logo = e.target.result;
                        AppState.updateAboutContent(logo, title, content);
                        showMessage('محتوا درباره ما با موفقیت ذخیره شد', 'success');
                        loadSiteSettings();
                    };
                    
                    reader.readAsDataURL(file);
                } else {
                    AppState.updateAboutContent(logo, title, content);
                    showMessage('محتوا درباره ما با موفقیت ذخیره شد', 'success');
                    loadSiteSettings();
                }
            });
            
            // رویداد بستن مودال‌ها
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // رویداد کلیک خارج از مودال برای بستن
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
            
            // رویداد بستن مودال تصویر
            document.querySelector('.close-image-modal').addEventListener('click', function() {
                document.getElementById('image-modal').style.display = 'none';
            });
            
            // رویداد کلیک خارج از مودال تصویر برای بستن
            document.getElementById('image-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            // رویداد اسکرول برای دکمه بازگشت به بالا
            window.addEventListener('scroll', function() {
                const scrollBtn = document.getElementById('scroll-to-top');
                if (window.pageYOffset > 300) {
                    scrollBtn.classList.add('visible');
                } else {
                    scrollBtn.classList.remove('visible');
                }
            });
            
            // رویداد کلیک دکمه بازگشت به بالا
            document.getElementById('scroll-to-top').addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // رویداد بروزرسانی صفحه
            document.getElementById('refresh-page').addEventListener('click', function() {
                AppState.applyUpdates();
            });
            
            // بارگذاری اولیه ورود محصولات
            initializeBulkProductInputs();
            
            // تنظیم دکمه خروج
            setupLogoutButtons();
            
            // راه‌اندازی سیستم بررسی بروزرسانی
            setInterval(() => {
                AppState.checkForUpdates();
            }, AppState.updateCheckInterval);
        });
    </script>
</body>
</html>